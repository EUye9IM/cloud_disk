# 安装手册

## 工具链

### 前端工具链安装

#### node.js

请安装较新(`version >= 14.0.0`)的[Node.js](https://nodejs.org/zh-cn/download/)。在Rocky Linux 8 中，可以直接使用`dnf`的`module`功能指定版本安装：
```bash
sudo dnf module enable nodejs:16 -y
sudo dnf install npm -y
```

> 注：若由于网络环境原因无法正常使用 `npm`，可以配置国内镜像源：
```bash
npm config set registry https://registry.npmmirror.com
# Electron 需要单独配置
npm config set electron_mirror https://npmmirror.com/mirrors/electron/
```

#### apache httpd

本应用提供编译后的 html 与 JavaScript 代码文件，可以借助任何现代 Web 服务器搭建。Rocky Linux 8 自带 Apache httpd，无需额外安装。

### 后端工具链搭建

#### gcc-c++

默认

#### mariadb-server

`dnf install mariadb-server -y`

#### mariadb-devel

`dnf install mariadb-devel -y`

### 编译

#### 前端页面

```bash
# 进入前端子目录
cd source/frontend
# 安装依赖
npm install
# 编译
npm run build
```

> 若需变更服务器地址，应当修改`source/frontend/src/config.ts`文件后重新编译

#### 客户端

```bash
# 客户端与Web端共享同一份目录
cd source/frontend
# 安装依赖（编译Web端时已安装，则不需重复安装）
npm install
# 编译
npm run electron:build
```
编译结果在`release/<版本号>`目录下，同时包含可执行文件与安装文件。

#### 服务端

`cd source && make`

### 安装

#### 配置前端至 Apache

完成编译后，前端网页在`dist`子目录下，将其复制到Web服务器的指定目录即可部署
```bash
cp -rf source/frontend/dist/* /var/www/html/
```

#### 配置服务开机自启动

在/etc/systemd/system/clouddisk.service中写入

```
[Unit]
Description=just big homework to build a remote disk
[Service]
Type=simple
ExecStart=clouddisk
[Install]
WantedBy=multi-user.target
```

输入以下命令注册自启

```
systemctl daemon-reload
systemctl enable clouddisk
```