# 技术手册

## 数据库设计

数据库只有三张表。

```
node(path,hash,mtime);
file(hash,size);
userinfo(name,pass);
```

node表存储文件系统树信息；file表存储文件信息；userinfo表存储用户与身份认证信息，用户密码经过哈希加密。

node中path格式为，‘/’分割，末尾统一保留‘/’不论是否是目录，hash记录文件哈希值，文件夹则为NULL，mtime记录文件（夹）最后修改时间。

## 文件于server端的存储

在管理员指定的文件夹内以哈希值为文件名存放用户文件，该值与数据表中hash字段的值一致。

## 用户目录结构设计

用户目录存放于数据库中的虚拟文件树中，为根目录下的子文件夹。例如用户user拥有名为file的文件，则该文件在数据库中的虚拟路径为/user/file。

## Client与Server端数据流、控制流信息

### 服务端与客户端的信息传递

在网盘的设计中，server端与client端通信的基础为http协议，所有的数据都是over http，server设置请求路由，而client发送相应的请求获取服务端的信息或上传自己的数据信息。

### 数据流信息

网盘的文件数据的实际信息通过http的请求或响应的body来存储发送传输，无论是上传还是下载，都通过此方式，因为body可以直接传输二进制，无需其他形式的转化。

### 控制流信息

其他信息，诸如用户登录、注册或者传看文件信息等，通过http的POST请求来实现，这是一个统一的设计，传递json数据，前后端可以对此进行解析。为确保客户登录的合法性，用户登录获取token，之后的每一次请求需要放置在http header中，随POST请求发送，服务端会进行token解析，在token合法的情形下，才会响应正确的信息，否则判定为无效登录。而关于前后端交互的具体路由接口，可以查看`src/router.md`获取详细信息。

## 遗憾、不足、改进

因为时间原因，前期将作业重点放在webrtc录屏部分，导致后期完成网盘作业的时间并不充裕，所以网盘的断点续传功能并没有完成，其余部分也略有瑕疵，其中有小组任务分配不合理的原因存在，更是因为整体对http协议部分的估计的偏差，对于其细节问题，诸如跨域、文件断点续传等并未完全理解，致使本次作业的部分功能的缺失。

一个项目需要有合理的规划，也需要有足够的时间作为支持，在项目推进的过程中，难免遇到问题，为了解决这些问题，需要时间上的保证，而这，需要前期对难度的合理估计，需要尽可能提前开始项目，不在ddl面前蹦迪。

